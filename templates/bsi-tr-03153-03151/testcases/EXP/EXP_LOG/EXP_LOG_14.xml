<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="../../schema/TR-03153-1-TS.css"?>
<TestCase id="EXP_LOG_14" xmlns="http://bsi.bund.de/TR03153" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bsi.bund.de/TR03153 ../../schema/TR-03153-1-TS_version-1-2-0.xsd">
  <Title>Datenfeld-Zuordnung Transaktionen (mit Aggregation, Single-Client)</Title>
  <Version>1.2.0</Version>
  <Purpose>Prüfung, ob bei der Protokollierung von Transaktionen, die zu sichernden Daten den zugehörigen Datenfeldern in den Transaktions-Log-Nachrichten zugeordnet werden.
Das Sicherheitsmodul der Technischen Sicherheitseinrichtung kann Daten des Vorgangs bei Aktualisierungen einer Transaktion aggregieren.
Die TSE kann zu einem Zeitpunkt nur von einem Aufzeichnungssystem für die Protokollierung von Transaktionen verwendet werden.</Purpose>
  <Profiles>
    <Profile>SM_AGG</Profile>
    <Profile>NO_MULTI_CLIENT</Profile>
  </Profiles>
  <References>
    <Reference>BSI TR-03153-1</Reference>
    <Reference>BSI TR-03151-1</Reference>
  </References>
  <Preconditions>
    <Precondition>Die Technische Sicherheitseinrichtung wurde initialisiert.</Precondition>
    <Precondition>Die Zeit innerhalb des Sicherheitsmoduls wurde aktualisiert.</Precondition>
    <Precondition>Der Nutzer logger wurde von der Technischen Sicherheitseinrichtung authentifiziert.</Precondition>
    <Precondition>Es ist ein Aufzeichnungssystem für die Aufzeichnung von Transaktionen registriert.</Precondition>
  </Preconditions>
  <TestSteps>
    <TestStep>
      <Command>Aufruf der Funktionalität für das Starten einer Transaktion. Der für processData übergebene Wert wird als $data1 festgehalten. Der für processType übergebene Wert wird als $typ1 festgehalten. Der für additionalExternalData übergebene Wert wird als $add1 festgehalten.</Command>
      <RefFunction>startTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für die Aktualisierung einer Transaktion. Der für processData übergebene Wert wird als $data2 festgehalten. Der für processType übergebene Wert wird als $typ2 festgehalten. Der für additionalExternalData übergebene Wert wird als $add2 festgehalten. Die übergebenen Daten unterscheiden sich von den zuvor übergebenen Daten.</Command>
      <RefFunction>updateTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für die Aktualisierung einer Transaktion. Der für processData übergebene Wert wird als $data3 festgehalten. Für processType wird der zuvor festgehaltene Wert $typ2 übergeben. Der für additionalExternalData übergebene Wert wird als $add3 festgehalten. Die übergebenen Daten unterscheiden sich von den zuvor übergebenen Daten1 und Daten2.</Command>
      <RefFunction>updateTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Beenden einer Transaktion. Der für processData übergebene Wert wird als $data4 festgehalten. Der für processType übergebene Wert wird als $typ4 festgehalten. Der für additionalExternalData übergebene Wert wird als $add4 festgehalten. Die übergebenen Daten unterscheiden sich von den zuvor übergebenen Daten.</Command>
      <RefFunction>finishTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie von Zertifikaten und Zusatzdateien.</Command>
      <RefFunction>exportLogMessages</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für das Starten der Transaktion in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für das Starten der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Prüfung der Inhalte von Datenfeldern in der Log-Nachricht für das Starten der Transaktion in dem TAR-Container.</Command>
      <ExpectedResults>
        <ExpectedResult>Der Wert des Datenfelds processData entspricht dem zuvor als $data1 festgehaltenen Wert.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds processType entspricht dem zuvor als $typ1 festgehaltenen Wert.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds additionalExternalData entspricht dem zuvor als $add1 festgehaltenen Wert.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für die Aktualisierung der Transaktion in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für die Aktualisierung der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Prüfung der Inhalte von Datenfeldern in der Log-Nachricht für die Aktualisierung der Transaktion in dem TAR-Container.</Command>
      <ExpectedResults>
        <ExpectedResult>Der Wert des Datenfelds processData entspricht der Konkatenation der zuvor als $data2 und $data3 festgehaltenen Werte.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds processType entspricht dem zuvor als $typ2 festgehaltenen Wert.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds additionalExternalData entspricht der Konkatenation der zuvor als $add2 und $add3 festgehaltenen Werte.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für das Beenden der Transaktion in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für das Beenden der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Prüfung der Inhalte von Datenfeldern in der Log-Nachricht für das Beenden der Transaktion in dem TAR-Container.</Command>
      <ExpectedResults>
        <ExpectedResult>Der Wert des Datenfelds processData entspricht dem zuvor als $data4 festgehaltenen Wert.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds processType entspricht dem zuvor als $typ4 festgehaltenen Wert.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds additionalExternalData entspricht dem zuvor als $add4 festgehaltenen Wert.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
  </TestSteps>
</TestCase>