<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="../../schema/TR-03153-1-TS.css"?>
<TestCase id="II_UBP_04" xmlns="http://bsi.bund.de/TR03153" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bsi.bund.de/TR03153 ../../schema/TR-03153-1-TS_version-1-2-0.xsd">
  <Title>PIN entsperren: ErrorPukIsTemporarilyBlocked</Title>
  <Version>1.2.0</Version>
  <Purpose>Prüfung, ob die Funktionalität zum Entsperren der PIN eines autorisierten Nutzers die Fehlermeldung ErrorPukIsTemporarilyBlocked auslöst und damit die wiederholte Ausführung zeitweise blockiert wird, wenn eine Password Guessing Attack erkannt wird.</Purpose>
  <RefFunction>unblockPin</RefFunction>
  <Profiles>
    <Profile>II</Profile>
    <Profile>PUK_BLOCKABLE</Profile>
  </Profiles>
  <References>
    <Reference>BSI TR-03153-1</Reference>
    <Reference>BSI TR-03151-1</Reference>
  </References>
  <Preconditions>
    <Precondition>Die Technische Sicherheitseinrichtung wurde initialisiert.</Precondition>
    <Precondition>Die Zeit innerhalb des Sicherheitsmoduls wurde aktualisiert.</Precondition>
    <Precondition>Es ist keiner der Nutzer admin, logger oder timeadmin von der Technischen Sicherheitseinrichtung authentifiziert.</Precondition>
    <Precondition>Die PIN-Eingabe für die Authentifizierung eines Nutzers ist blockiert (Wert für den Wiederholungszähler ist 0).</Precondition>
  </Preconditions>
  <TestSteps>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Entsperren der PIN eines autorisierten Nutzers. Der Aufruf wird mehrere Male wiederholt. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und eine neue PIN übergeben. Die übergebene PUK ist nicht korrekt. Die Funktionalität wird aufgerufen, bis der Mechanismus zum Schutz vor der Password Guessing Attack greift. </Command>
      <RefFunction>unblockPin</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorIncorrectPuk ausgelöst, wenn der Mechanismus zum Schutz vor der Password Guessing Attack noch nicht greift.</ExpectedResult>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorPukTemporarilyBlocked ausgelöst, sobald der Mechanismus zum Schutz vor der Password Guessing Attack greift.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Entsperren der PIN eines autorisierten Nutzers. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und eine neue PIN übergeben. Die übergebene PUK ist nicht korrekt. </Command>
      <RefFunction>unblockPin</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorPukTemporarilyBlocked ausgelöst.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Entsperren der PIN eines autorisierten Nutzers. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und eine neue PIN übergeben. Die übergebene PUK ist korrekt. </Command>
      <RefFunction>unblockPin</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorPukTemporarilyBlocked ausgelöst.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Authentifizierung von Nutzern. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und die im vorherigen Schrit neu zu setzen versuchte PIN übergeben.</Command>
      <RefFunction>authenticateUser</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorPinBlocked ausgelöst.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Authentifizierung von Nutzern. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und die ursprünglich gesetzte PIN übergeben.</Command>
      <RefFunction>authenticateUser</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird beendet und es wird die Fehlermeldung ErrorPinBlocked ausgelöst.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie Zertifikate und Zusatzdateien.</Command>
      <RefFunction>exportLogMessages</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachrichten für die Versuche zum Entsperren der PIN des Nutzers in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens. Es werden die Aufrufe aus Testschritt 1 betrachtet.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält die Log-Nachrichten für die Entsperrversuche der PIN des Nutzers.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Prüfung der Inhalte von Datenfeldern in den Log-Nachrichten für das Entsperren der PIN des Nutzers in dem TAR-Container. Es werden die Aufrufe aus Testschritt 1 betrachtet, welche vor dem Greifen des Schutzes vor Password Guessing Attack erstellt wurden.</Command>
      <ExpectedResults>
        <ExpectedResult>Der Wert des Datenfelds eventType entspricht unblockPin.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds eventOrigin entspricht integration-interface.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds eventTriggeredByUser entspricht unauthenticated.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds userToUnblock entspricht dem in Testschritt 1 übergebenen Namen.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds unblockResult entspricht incorrectPuk.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für das Entsperren der PIN des Nutzers in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens. Es wird der letzte Aufruf aus Schritt 1 (bei dem die Password Guessing Attack detekiert wurde) und die Aufrufe aus Testschritt 2 und Testschritt 3 betrachtet.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält jeweils eine Log-Nachricht für jedes Entsperren der PIN des Nutzers.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Prüfung der Inhalte von Datenfeldern in den Log-Nachrichten für das Entsperren der PIN des Nutzers in dem TAR-Container. Es wird der letzte Aufruf aus Schritt 1 (bei dem die Password Guessing Attack detekiert wurde) und die Aufrufe aus Testschritt 2 und Testschritt 3 betrachtet.</Command>
      <ExpectedResults>
        <ExpectedResult>Der Wert des Datenfelds eventType entspricht unblockPin.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds eventOrigin entspricht integration-interface.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds eventTriggeredByUser entspricht unauthenticated.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds userToUnblock entspricht dem in Testschritt 1 übergebenen Namen.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds unblockResult entspricht unblockingTemporarilyBlocked.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Für die Zeit, die der Hersteller angibt, bis die Eingabe der PUK nicht mehr blockiert ist, wird keine weitere Funktion aufgerufen.</Command>
      <ExpectedResults>
        <ExpectedResult>Für die Zeit, die der Hersteller angibt, bis die Eingabe der PUK nicht mehr blockiert ist, wurde keine Funktion aufgerufen.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Entsperren der PIN eines autorisierten Nutzers. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und eine neue PIN übergeben. Die übergebene PUK ist korrekt.</Command>
      <RefFunction>unblockPin</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Authentifizierung von Nutzern. Der Funktion wird die User-ID des Nutzers, dessen PIN-Eingabe für die Authentifizierung blockiert ist, und die neu gesetzte PIN übergeben.</Command>
      <RefFunction>authenticateUser</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
  </TestSteps>
</TestCase>