<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="../../schema/TR-03153-1-TS.css"?>
<TestCase id="II_CSC_01" xmlns="http://bsi.bund.de/TR03153" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bsi.bund.de/TR03153 ../../schema/TR-03153-1-TS_version-1-2-0.xsd">
  <Title>Ausgabe aktueller Signaturzählerstand</Title>
  <Version>1.2.0</Version>
  <Purpose>Prüfung, ob die Funktionalität zur Ausgabe des aktuellen Stands des Signaturzählers den aktuellen Stand der Signaturzähler ausgibt. Zusätzlich erfolgen Prüfungen, ob die Ausführung ohne Fehlermeldung beendet wird und ob das richtige Format für den Rückgabeparameter verwendet wird.</Purpose>
  <RefFunction>exportLogMessages</RefFunction>
  <RefFunction>getCurrentLoggingSignatureCounters</RefFunction>
  <RefUser>logger</RefUser>
  <Profiles>
    <Profile>II</Profile>
  </Profiles>
  <References>
    <Reference>BSI TR-03153-1</Reference>
    <Reference>BSI TR-03151-1</Reference>
  </References>
  <Preconditions>
    <Precondition>Die Technische Sicherheitseinrichtung wurde initialisiert.</Precondition>
    <Precondition>Die Zeit innerhalb des Sicherheitsmoduls wurde aktualisiert.</Precondition>
    <Precondition>Der Nutzer logger wurde von der Technischen Sicherheitseinrichtung authentifiziert.</Precondition>
  </Preconditions>
  <TestSteps>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie von Zertifikaten und Zusatzdateien.</Command>
      <RefFunction>exportLogMessages</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation des höchsten Stands des Signaturzählers, der im Dateinamen von Log-Nachrichten gelistet ist.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht, die einen höheren Stand des Signaturzählers im Dateinamen enthält, als jede andere Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe des aktuellen Stands des Signaturzählers.</Command>
      <RefFunction>getCurrentLoggingSignatureCounters</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Wert im Rückgabeparameter signatureCounters entspricht der vorgegebenen ASN.1 Definition. Es wird eine DER Kodierung verwendet.</ExpectedResult>
        <ExpectedResult>Das Element SignatureCounterSet enthält für genau einen Schlüssel den aktuellen Stand des Signaturzählers.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds keySerialNumber entspricht dem Hash über den öffentlichen Schlüssel, der für die Verifikation von Log-Nachrichten verwendet wird.</ExpectedResult>
        <ExpectedResult>Der Wert des Datenfelds counterValue entspricht dem höchsten Stand des Signaturzählers in den exportierten Daten.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
  </TestSteps>
</TestCase>