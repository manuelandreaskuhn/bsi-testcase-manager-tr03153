<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="../../schema/TR-03153-1-TS.css"?>
<TestCase id="II_GLT_03" xmlns="http://bsi.bund.de/TR03153" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bsi.bund.de/TR03153 ../../schema/TR-03153-1-TS_version-1-2-0.xsd">
  <Title>Letzte Transaktions-Log-Nachricht abrufen mit Transaktionsnummer</Title>
  <Version>1.2.0</Version>
  <Purpose>Prüfung, ob die Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht die zuletzt erstellte Transaktions-Log-Nachricht und einen korrekten Namen für diese Log-Nachricht ausgibt. Zusätzlich erfolgt eine Prüfung, ob die Ausführung ohne Fehlermeldung beendet wird.
Es wird eine Transaktionsnummer übergeben.
Das Sicherheitsmodul der Technischen Sicherheitseinrichtung kann Daten des Vorgangs bei Aktualisierungen einer Transaktion nicht aggregieren.</Purpose>
  <RefFunction>getLastTransactionLogMessage</RefFunction>
  <RefUser>logger</RefUser>
  <Profiles>
    <Profile>II_LASTTRANSLOG</Profile>
    <Profile>SM_NOAGG</Profile>
    <Profile>SM_MULTI</Profile>
  </Profiles>
  <References>
    <Reference>BSI TR-03153-1</Reference>
    <Reference>BSI TR-03151-1</Reference>
  </References>
  <Preconditions>
    <Precondition>Die Technische Sicherheitseinrichtung wurde initialisiert.</Precondition>
    <Precondition>Die Zeit innerhalb des Sicherheitsmoduls wurde aktualisiert.</Precondition>
    <Precondition>Der Nutzer logger wurde von der Technischen Sicherheitseinrichtung authentifiziert.</Precondition>
    <Precondition>Es ist ein Aufzeichnungssystem registriert.</Precondition>
  </Preconditions>
  <TestSteps>
    <TestStep>
      <Command>Aufruf der Funktionalität für das Starten einer Transaktion.</Command>
      <RefFunction>startTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Über den Rückgabewert transactionNumber wird ein Wert zurückgegeben. Dieser wird als $tn1 festgehalten.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für das Starten einer Transaktion.</Command>
      <RefFunction>startTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Über den Rückgabewert transactionNumber wird ein Wert zurückgegeben. Dieser wird als $tn2 festgehalten.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie von Zertifikaten und Zusatzdateien.</Command>
      <RefFunction>exportFilteredTransactionLogs</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für das Starten der Transaktion mit der Transaktionsnummer $tn1 in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für das Starten der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht. Für transactionNumber wird der zuvor festgehaltene Wert $tn1 übergeben.</Command>
      <RefFunction>getLastTransactionLogMessage</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageFileName entspricht dem Dateinamen, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageContent entspricht dem Inhalt, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für die Aktualisierung einer Transaktion. Für transactionNumber wird der zuvor festgehaltene Wert $tn2 übergeben.</Command>
      <RefFunction>updateTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie von Zertifikaten und Zusatzdateien.</Command>
      <RefFunction>exportFilteredTransactionLogs</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für die Aktualisierung der Transaktion mit der Transaktionsnummer $tn2 in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für die Aktualisierung der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht. Für transactionNumber wird der zuvor festgehaltene Wert $tn1 übergeben.</Command>
      <RefFunction>getLastTransactionLogMessage</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageFileName entspricht dem Dateinamen, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageContent entspricht dem Inhalt, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht. Für transactionNumber wird der zuvor festgehaltene Wert $tn2 übergeben.</Command>
      <RefFunction>getLastTransactionLogMessage</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageFileName entspricht dem Dateinamen, der in Testschritt 8 identifizierten Datei.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageContent entspricht dem Inhalt, der in Testschritt 8 identifizierten Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Beenden einer Transaktion. Für transactionNumber wird der zuvor festgehaltene Wert $tn2 übergeben.</Command>
      <RefFunction>finishTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht. Für transactionNumber wird der zuvor festgehaltene Wert $tn1 übergeben.</Command>
      <RefFunction>getLastTransactionLogMessage</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageFileName entspricht dem Dateinamen, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageContent entspricht dem Inhalt, der in Testschritt 4 identifizierten Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zum Beenden einer Transaktion. Für transactionNumber wird der zuvor festgehaltene Wert $tn1 übergeben.</Command>
      <RefFunction>finishTransaction</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität für den Export aller Log-Nachrichten sowie von Zertifikaten und Zusatzdateien.</Command>
      <RefFunction>exportFilteredTransactionLogs</RefFunction>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Die TSE-Schnittstelle gibt einen TAR-Container zurück.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Identifikation der Log-Nachricht für das Beenden der Transaktion mit der Transaktionsnummer $tn2 in dem TAR-Container. Die Identifikation erfolgt anhand des Dateinamens.</Command>
      <ExpectedResults>
        <ExpectedResult>Der TAR-Container enthält eine Log-Nachricht für das Beenden der Transaktion.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
    <TestStep>
      <Command>Aufruf der Funktionalität zur Ausgabe der zuletzt erzeugten Transaktions-Log-Nachricht. Für transactionNumber wird der zuvor festgehaltene Wert $tn2 übergeben.</Command>
      <RefFunction>getLastTransactionLogMessage</RefFunction>
      <RefUser>logger</RefUser>
      <ExpectedResults>
        <ExpectedResult>Die Ausführung wird ohne Fehlermeldung beendet.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageFileName entspricht dem Dateinamen, der in Testschritt 15 identifizierten Datei.</ExpectedResult>
        <ExpectedResult>Der Rückgabewert logMessageContent entspricht dem Inhalt, der in Testschritt 15 identifizierten Datei.</ExpectedResult>
      </ExpectedResults>
    </TestStep>
  </TestSteps>
</TestCase>